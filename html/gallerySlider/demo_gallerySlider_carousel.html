<!-- 
  	作者：dailc
          时间：2016-12-12
          描述：图片轮播,2d,3d(旋转木马)效果
          类库包括了2d图片轮播和3d图片轮播效果,进一步封装，更方便调用
          
    todo:封装简化,append
-->
<!DOCTYPE html>
<html lang="zh-CN">

	<head>
		<meta charset="UTF-8">
		<!-- 让国内基于webkit的浏览器默认采用webkit内核进行渲染 -->
		<meta name="renderer" content="webkit" />
		<!-- 移动端的响应式特性 -->
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<meta content="图片轮播,3d图片轮播,旋转木马,css,js,translate3d,gallerSlider,carousel" name="Keywords">
		<meta content="图片轮播实现示例(2D,3D)" name="description">
		<title>图片轮播实现示例(2D,3D)</title>
		<link rel="stylesheet" href="../../css/common/reset.css" />
		<link rel="stylesheet" href="../../js/gallerySlider/EffectLib.Carrousel.css" />
		<link rel="stylesheet" href="../../css/gallerySlider/demo_gallerySlider_carousel.css" />

	</head>

	<body>
		<div class="show-3d-gallery-slider">
			<div class="gallery-slider">
				<div class="dai-carrousel-state">
					<div class="dai-carrousel-container">
						<div class="dai-carrousel-item" style="background: #3b76c0">
							<img src="../../img/bg1.jpg" />
						</div>
						<div class="dai-carrousel-item" style="background: #58c03b;">
							<img src="../../img/bg2.jpg" />
						</div>
						<div class="dai-carrousel-item custom-item" style="background: #e0a718;height: 100px;">
							<h1>Hello World</h1>
							<button id="hello word">Hello Word</button>
							<a href="https://dailc.github.io/" target="_blank">测试链接</a>
						</div>
						<div class="dai-carrousel-item" style="background: #c03b25;">
							<img src="../../img/bg3.jpg" />
						</div>
						<div class="dai-carrousel-item" style="background: #e0a718;">
							<img src="../../img/bg4.jpg" />
						</div>
						<div class="dai-carrousel-item" style="background: #c03eac;">
							<img src="../../img/bg5.jpg" />
						</div>
						<div class="dai-carrousel-item custom-item" style="background: #e0a718;height: 100px;">

						</div>
					</div>
				</div>
			</div>

			<div class="option">
				<div class="prev"><button class="btn-prev">prev</button></div>
				<div class="next"><button class="btn-next">next</button></div>
				<div class="random"><button class="btn-random">random</button></div>
				<div class="random"><button class="btn-change-mode">3D,2D模式切换</button></div>
				<div class="random"><button class="btn-change-height">是否固定高度的切换(不固定now)</button></div>
				<div class="random"><button class="btn-img-fill">是否img填充的切换(不填充now)</button></div>
				<div class="random"><button class="btn-append">添加新元素(随机颜色div)</button></div>
				<input id="widthChange" type="range" min="30" max="100" />
			</div>
		</div>

		<script type="text/javascript" src="../../js/common/LinkList.js"></script>
		<script type="text/javascript" src="../../js/gallerySlider/EffectLib.Carrousel.js"></script>
		<script>
			var options = {
				'containerSelector': '.show-3d-gallery-slider',
				'itemSelector': '.dai-carrousel-item',
				'is3D': true,
				'isLoop': true,
				'itemWidth': '50%',
				//强制固定高度
				//'itemHeight': '160px',
				//item的img样式,默认是 auto，也可以设置为 100%
				//只有当item是div,并且存在img子级才有用
				'itemImgHeight': ''
			};
			var clickHandle = function(i, e) {
				console.log("点击:" + i);
			};
			var slider = new EffectLib.Carrousel(options).bindItemChangedHandler(function(preIndex, currentIndex) {
				console.log("preIndex：" + preIndex + ',currentIndex:' + currentIndex);
			}).bindItemClickHandler(clickHandle);

			document.querySelector(".btn-prev").addEventListener("click", function() {
				slider.prev();
			});

			document.querySelector(".btn-next").addEventListener("click", function() {
				slider.next();
			});

			document.querySelector(".btn-random").addEventListener("click", function() {
				slider.moveTo(Math.floor(Math.random() * 4));
				//slider.moveTo(4);
			});
			//btn-img-fill
			var imgDom = document.querySelector(".btn-img-fill");
			imgDom.addEventListener("click", function() {
				if(options.itemImgHeight && options.itemImgHeight !== 'auto') {
					options.itemImgHeight = '';
					imgDom.innerText = '是否img填充的切换(不填充now)';
				} else {
					options.itemImgHeight = '100%';
					imgDom.innerText = '是否img填充的切换(填充now)';
				}
				appendNew();
				appendNew();

				slider.reset(options);
			});
			var heightDom = document.querySelector(".btn-change-height");
			heightDom.addEventListener("click", function() {
				if(options.itemHeight) {
					options.itemHeight = '';
					heightDom.innerText = '是否固定高度的切换(不固定now)';
				} else {
					options.itemHeight = '200px';
					heightDom.innerText = '是否固定高度的切换(固定now)';
				}
				appendNew();
				appendNew();

				slider.reset(options);
			});
			document.querySelector(".btn-append").addEventListener("click", function() {

				appendNew();
				//container.innerHTML += litemplate;
				//这次重置不更新options
				slider.reset();
			});
			document.querySelector(".btn-change-mode").addEventListener("click", function() {
				if(options.is3D) {
					//3d变2d
					options.is3D = false;
				} else {
					//2d变3d
					options.is3D = true;
				}
				//先解绑才能继续监听,否则就算reset了也不能
				slider.reset(options).unBindItemClickHandler().bindItemClickHandler(function(i) {
					console.log("mode点击:" + i);
				});
			});

			var rangeDom = document.querySelector('#widthChange');
			rangeDom.addEventListener("input", function() {
				options.itemWidth = rangeDom.value + '%';
				slider.reset(options);
			});
			//使用tap事件,因为内部的click被屏蔽了
			slider.tap(document.getElementById('hello word'), function(e) {
				alert('Hello World!');

			});
			//a标签,因为默认的事件已经被阻止了的
			slider.tap('.custom-item a', function(e) {
				var href = this.getAttribute('href');
				console.log("href:" + href);
				if(href) {
					if(window.opener) {
						window.open(href, '_blank');
					} else {
						window.location.href = href;
					}
					
				}
			});

			function appendNew() {
				var litemplate =
					'<div class="dai-carrousel-item custom-item" style="background: {{COLOR}};height: {{HEIGHT}}px;"></div>';
				litemplate = litemplate.replace('{{COLOR}}', randomColor()).replace('{{HEIGHT}}', ~~(Math.random() * 100 + 100));

				var container = document.querySelector('.dai-carrousel-container');
				appendHtmlChildCustom(container, litemplate);
			}

			function randomColor() {
				var colorElements = "0,1,2,3,4,5,6,7,8,9,a,b,c,d,e,f";
				var colorArray = colorElements.split(",");
				var color = "#";
				for(var i = 0; i < 6; i++) {
					color += colorArray[Math.floor(Math.random() * 16)];
				}
				return color;
			}

			/**
			 * @description 将string字符串转为html对象,默认创一个div填充
			 * @param {String} strHtml 目标字符串
			 * @return {HTMLElement} 返回处理好后的html对象,如果字符串非法,返回null
			 */
			function pareseStringToHtml(strHtml) {
				if(strHtml == null || typeof(strHtml) != "string") {
					return null;
				}
				//创一个灵活的div
				var i, a = document.createElement("div");
				var b = document.createDocumentFragment();
				a.innerHTML = strHtml;
				while(i = a.firstChild) b.appendChild(i);
				return b;
			};
			/**
			 * @description给html对象添加子元素
			 * @param {HTMLElement} targetObj 目标dom，必须是原生对象
			 * @param {HTMLElement||String} childElem 目标html的字符串或者是dom对象
			 */
			function appendHtmlChildCustom(targetObj, childElem) {
				if(typeof targetObj === 'string') {
					targetObj = document.querySelector(targetObj);
				}
				if(targetObj == null || childElem == null || !(targetObj instanceof HTMLElement)) {
					return;
				}
				if(childElem instanceof HTMLElement) {
					targetObj.appendChild(childElem);
				} else {
					//否则,创建dom对象然后添加
					var tmpDomObk = pareseStringToHtml(childElem);
					if(tmpDomObk != null) {
						targetObj.appendChild(tmpDomObk);
					}
				}
			};
		</script>
	</body>

</html>